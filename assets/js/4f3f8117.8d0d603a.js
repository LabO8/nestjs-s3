"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[734],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return d}});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},f=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),f=c(r),d=i,g=f["".concat(s,".").concat(d)]||f[d]||u[d]||o;return r?n.createElement(g,l(l({ref:t},p),{},{components:r})):n.createElement(g,l({ref:t},p))}));function d(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,l=new Array(o);l[0]=f;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:i,l[1]=a;for(var c=2;c<o;c++)l[c]=r[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}f.displayName="MDXCreateElement"},172:function(e,t,r){r.r(t),r.d(t,{contentTitle:function(){return s},default:function(){return f},frontMatter:function(){return a},metadata:function(){return c},toc:function(){return p}});var n=r(7462),i=r(3366),o=(r(7294),r(3905)),l=["components"],a={id:"prefixing",title:"Prefixing",sidebar_label:"Prefixing",slug:"/prefixing"},s=void 0,c={unversionedId:"prefixing",id:"prefixing",title:"Prefixing",description:"Introduction",source:"@site/docs/prefixing.md",sourceDirName:".",slug:"/prefixing",permalink:"/nestjs-s3/prefixing",editUrl:"https://github.com/LabO8/nestjs-s3/docs/prefixing.md",tags:[],version:"current",frontMatter:{id:"prefixing",title:"Prefixing",sidebar_label:"Prefixing",slug:"/prefixing"},sidebar:"docsSidebar",previous:{title:"Download helper",permalink:"/nestjs-s3/download-helper"},next:{title:"Deletion helper",permalink:"/nestjs-s3/deletion-helper"}},p=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"Usage",id:"usage",children:[],level:2},{value:"Custom prefixing",id:"custom-prefixing",children:[],level:2}],u={toc:p};function f(e){var t=e.components,r=(0,i.Z)(e,l);return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"As our app grows, we might want to store our objects in a more organized way. This is where the prefix comes in."),(0,o.kt)("p",null,"The prefix is a string that is prepended to the object key. This allows us to organize our objects in a folder-like structure."),(0,o.kt)("p",null,"For example, if we have a bucket called ",(0,o.kt)("inlineCode",{parentName:"p"},"my-bucket")," and we want to store our objects in a folder called ",(0,o.kt)("inlineCode",{parentName:"p"},"my-folder"),", we can do that by prepending the prefix ",(0,o.kt)("inlineCode",{parentName:"p"},"my-folder/")," to the object key."),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,"By default, the prefix is an empty string. This means that the object key is not modified, but if you set a prefix, when you initialize the module, the prefix will be prepended to the object key."),(0,o.kt)("p",null,"The default algorithm for prefixing will just prepend the prefix to the object key, but you can also specify a custom algorithm."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"All services like the ",(0,o.kt)("inlineCode",{parentName:"strong"},"ObjectService")," will use the prefix service by default.")),(0,o.kt)("h2",{id:"custom-prefixing"},"Custom prefixing"),(0,o.kt)("p",null,"In order to use a custom prefixing algorithm, you need to specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"prefixingAlgorithm")," when initializing the module."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"class CustomPrefixService implements IPrefixAlgorithm {\n  prefix(remote: string, prefix: string, bucket?: string): string {\n    return `${bucket}/${prefix}${remote}`;\n  }\n}\n\nS3Module.forRoot({\n  region: 'region',\n  accessKeyId: '***',\n  secretAccessKey: '***',\n  prefix: 'test/',\n  prefixAlgorithm: new CustomPrefixService(),\n})\n")),(0,o.kt)("p",null,"you can also use injectables"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"}," class CustomPrefixWithDIService implements IPrefixAlgorithm {\n  public constructor(private readonly globalPrefix: string) {}\n\n  prefix(remote: string, prefix: string, bucket?: string): string {\n    return `${bucket}/${this.globalPrefix}${prefix}${remote}`;\n  }\n}\n\nS3Module.forRootAsync({\n  imports: [SomeModuleThatProvidesTheGlobalPrefix],\n  prefixAlgorithmInject: ['GLOBAL_PREFIX'],\n  prefixAlgorithmFactory: (globalPrefix: string) => new CustomPrefixWithDIService(globalPrefix),\n  useFactory: () => ({\n    region: 'region',\n    accessKeyId: '***',\n    secretAccessKey: '***',\n    prefix: 'test/',\n  }),\n})\n")))}f.isMDXComponent=!0}}]);